<Window x:Class="ComicViewer.ComicReaderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="漫画阅读器" 
        WindowState="Maximized"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="Black"
        KeyDown="Window_KeyDown"
        MouseWheel="Window_MouseWheel">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- 导入按钮样式 -->
                <ResourceDictionary Source="Styles/Buttons.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <!-- 动画资源 -->
            <Storyboard x:Key="FadeIn">
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3"/>
            </Storyboard>
            <Storyboard x:Key="FadeOut">
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="1" To="0" Duration="0:0:0.3"/>
            </Storyboard>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <!-- 顶部控制栏 -->
        <Border x:Name="TopControlBar"
                Height="50" 
                VerticalAlignment="Top"
                Background="#80000000"
                Opacity="0"
                MouseEnter="ControlBar_MouseEnter"
                MouseLeave="ControlBar_MouseLeave">
            <Grid>
                <!-- 返回按钮 -->
                <Button x:Name="BackButton"
                        Content="← 返回"
                        Width="80" Height="30"
                        Margin="10,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Click="BackButton_Click"
                        Style="{StaticResource TransparentButtonStyle}"/>

                <!-- 标题 -->
                <TextBlock x:Name="TitleText"
                           Text="漫画标题"
                           Foreground="White"
                           FontSize="16"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>

                <!-- 页面信息 -->
                <TextBlock x:Name="PageInfoText"
                           Text="0/0"
                           Foreground="White"
                           Margin="0,0,20,0"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- 底部控制栏 -->
        <Border x:Name="BottomControlBar"
                Height="60"
                VerticalAlignment="Bottom"
                Background="#80000000"
                Opacity="0"
                MouseEnter="ControlBar_MouseEnter"
                MouseLeave="ControlBar_MouseLeave">
            <Grid>
                <!-- 页面控制 -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <Button x:Name="FirstPageButton"
                            Content="|◀"
                            Style="{StaticResource CircleIconButtonStyle}"
                            Width="40" Height="40"
                            Click="FirstPageButton_Click"
                            ToolTip="第一页"/>

                    <Button x:Name="PrevPageButton"
                            Content="◀"
                            Style="{StaticResource CircleIconButtonStyle}"
                            Width="40" Height="40"
                            Margin="10,0"
                            Click="PrevPageButton_Click"
                            ToolTip="上一页"/>

                    <!-- 页面跳转 -->
                    <TextBox x:Name="PageJumpTextBox"
                             Width="60" Height="30"
                             Margin="10,0"
                             TextAlignment="Center"
                             VerticalContentAlignment="Center"
                             KeyDown="PageJumpTextBox_KeyDown"/>
                    <TextBlock Text="/"
                               Foreground="White"
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="TotalPagesText"
                               Text="0"
                               Foreground="White"
                               Margin="5,0,10,0"
                               VerticalAlignment="Center"/>

                    <Button x:Name="NextPageButton"
                            Content="▶"
                            Style="{StaticResource CircleIconButtonStyle}"
                            Width="40" Height="40"
                            Margin="10,0"
                            Click="NextPageButton_Click"
                            ToolTip="下一页"/>

                    <Button x:Name="LastPageButton"
                            Content="▶|"
                            Style="{StaticResource CircleIconButtonStyle}"
                            Width="40" Height="40"
                            Click="LastPageButton_Click"
                            ToolTip="最后一页"/>
                </StackPanel>

                <!-- 阅读设置 -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Margin="0,0,20,0">
                    <ComboBox x:Name="ZoomComboBox"
                              Width="100" Height="30"
                              SelectedIndex="2">
                        <ComboBoxItem>适应宽度</ComboBoxItem>
                        <ComboBoxItem>适应高度</ComboBoxItem>
                        <ComboBoxItem>原始大小</ComboBoxItem>
                        <ComboBoxItem>50%</ComboBoxItem>
                        <ComboBoxItem>100%</ComboBoxItem>
                        <ComboBoxItem>150%</ComboBoxItem>
                    </ComboBox>

                    <ToggleButton x:Name="TwoPageModeToggle"
                                  Content="双页模式"
                                  Style="{StaticResource NoBorderToggleButtonStyle}"
                                  Width="80" Height="30"
                                  Margin="10,0"
                                  Checked="TwoPageModeToggle_Checked"
                                  Unchecked="TwoPageModeToggle_Unchecked"/>

                    <ToggleButton x:Name="FullScreenToggle"
                                  Content="全屏"
                                  Style="{StaticResource NoBorderToggleButtonStyle}"
                                  Width="60" Height="30"
                                  Margin="10,0"
                                  Checked="FullScreenToggle_Checked"
                                  Unchecked="FullScreenToggle_Unchecked"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 漫画显示区域 -->
        <ScrollViewer x:Name="ImageScrollViewer"
              Margin="0,50,0,60">

            <Viewbox x:Name="ContentViewbox" 
             Stretch="Uniform"
             MaxWidth="{Binding ActualWidth, ElementName=ImageScrollViewer}"
             MaxHeight="{Binding ActualHeight, ElementName=ImageScrollViewer}"
             MouseWheel="Window_MouseWheel">

                <Grid>
                    <StackPanel x:Name="SinglePagePanel"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                        <Image x:Name="CurrentPageImage"
                       Stretch="None"/>
                    </StackPanel>

                    <WrapPanel x:Name="TwoPagePanel"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Visibility="Collapsed">
                        <Image x:Name="LeftPageImage" Margin="5" Stretch="None"/>
                        <Image x:Name="RightPageImage" Margin="5" Stretch="None"/>
                    </WrapPanel>
                </Grid>

            </Viewbox>

        </ScrollViewer>

        <!-- 加载指示器 -->
        <Border x:Name="LoadingIndicator"
                Background="#80000000"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <ProgressBar Width="200" Height="20"
                             IsIndeterminate="True"/>
                <TextBlock Text="加载中..."
                           Foreground="White"
                           Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- 退出提示 -->
        <Border x:Name="ExitHint"
                Background="#80000000"
                CornerRadius="10"
                Width="200" Height="100"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Opacity="0"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <TextBlock Text="按 ESC 退出"
                           Foreground="White"
                           FontSize="18"
                           FontWeight="Bold"/>
                <TextBlock Text="按 F 全屏"
                           Foreground="LightGray"
                           Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>