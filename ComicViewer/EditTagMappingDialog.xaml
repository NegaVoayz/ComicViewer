<!-- EditTagMappingDialog.xaml -->
<Window x:Class="ComicViewer.EditTagMappingDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="编辑词映射表" 
        Width="600" Height="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <Window.Resources>
        <!-- 红色删除按钮样式 -->
        <Style x:Key="MyRemoveButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FF4444"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="ExtraBold"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#FF2222"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Foreground" Value="#FF0000"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 绿色添加按钮样式 -->
        <Style x:Key="AddButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#4CAF50"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="ExtraBold"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#3E8E41"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Foreground" Value="#2E7D32"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Foreground" Value="#A5D6A7"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 映射条目样式 -->
        <Style x:Key="MappingItemStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="10,8"/>
        </Style>

        <!-- 文本框样式 -->
        <Style x:Key="MappingTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="28"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="12"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#2196F3"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <TextBlock Grid.Row="0" 
                   Text="编辑词映射表"
                   FontSize="16"
                   FontWeight="SemiBold"
                   Margin="0,0,0,15"/>

        <!-- 映射列表区域 -->
        <Border Grid.Row="1"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 列表标题栏 -->
                <Border Grid.Row="0"
                        Background="#F5F5F5"
                        BorderBrush="#E0E0E0"
                        BorderThickness="0,0,0,1"
                        Padding="10, 8, 10, 0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="Alias (别名)"
                                   FontWeight="Medium"
                                   FontSize="12"
                                   Foreground="#666"
                                   HorizontalAlignment="Center"/>

                        <TextBlock Grid.Column="1"
                                   Text="→"
                                   FontWeight="Medium"
                                   FontSize="18"
                                   Foreground="#666"
                                   Margin="10,0"
                                   HorizontalAlignment="Center"/>

                        <TextBlock Grid.Column="2"
                                   Text="Tag Name (标签名)"
                                   FontWeight="Medium"
                                   FontSize="12"
                                   Foreground="#666"
                                   HorizontalAlignment="Center"/>

                        <TextBlock Grid.Column="3"
                                   Text="操作"
                                   FontWeight="Medium"
                                   FontSize="12"
                                   Foreground="#666"
                                   Width="60"
                                   HorizontalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 映射列表 -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="MappingListControl"
                                  ItemsSource="{Binding SelectedTagAliases}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource MappingItemStyle}">
                                    <Grid Margin="0,0,20,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Alias显示 -->
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Alias}"
                                                   FontSize="12"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"/>

                                        <!-- 箭头 -->
                                        <TextBlock Grid.Column="1"
                                                   Text="→"
                                                   FontWeight="Bold"
                                                   FontSize="18"
                                                   Margin="10,0"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"/>

                                        <!-- Tag Name显示 -->
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding Name}"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"/>

                                        <!-- 删除按钮 -->
                                        <Button Grid.Column="3"
                                                Content="━"
                                                Style="{StaticResource MyRemoveButtonStyle}"
                                                Click="RemoveMappingButton_Click"
                                                Tag="{Binding}"
                                                Width="24"
                                                Height="24"
                                                VerticalContentAlignment="Center"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- 添加新映射区域 -->
        <Border Grid.Row="2"
                Margin="0,15,0,0"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                CornerRadius="4"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Alias输入框 -->
                <TextBox x:Name="NewAliasTextBox"
                         Grid.Column="0"
                         Text=""
                         TextChanged="OnNewAliasChanged"
                         KeyDown="NewMappingTextBox_KeyDown"
                         Padding="0,0,0,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource MappingTextBoxStyle}">
                            <Setter Property="Background" Value="White"/>
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush AlignmentX="Left" 
                                                         AlignmentY="Center" 
                                                         Stretch="None">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="输入别名..."
                                                               Foreground="#888"
                                                               FontSize="12"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- 箭头 -->
                <TextBlock Grid.Column="1"
                           Text="→"
                           FontWeight="ExtraBold"
                           FontSize="18"
                           Margin="10,0"
                           VerticalAlignment="Center"/>

                <!-- Tag Name输入框 -->
                <TextBox x:Name="NewTagNameTextBox"
                         Grid.Column="2"
                         Text=""
                         TextChanged="OnNewNameChanged"
                         KeyDown="NewMappingTextBox_KeyDown"
                         Padding="0,0,0,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource MappingTextBoxStyle}">
                            <Setter Property="Background" Value="White"/>
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush AlignmentX="Left" 
                                                         AlignmentY="Center" 
                                                         Stretch="None">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="输入标签名..."
                                                               Foreground="#888"
                                                               FontSize="12"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- 添加按钮 -->
                <Button x:Name="AddMappingButton"
                        Grid.Column="3"
                        Content="+"
                        Style="{StaticResource AddButtonStyle}"
                        Click="AddMappingButton_Click"
                        IsEnabled="{Binding CanAddMapping}"
                        Margin="10,0,0,0"
                        VerticalContentAlignment="Center"/>
            </Grid>
        </Border>

        <!-- 底部按钮 -->
        <Border Grid.Row="4"
                Background="#F5F5F5"
                Margin="-10,5,-10,-10"
                Padding="10">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button x:Name="CancelButton"
                        Content="取消"
                        Width="80"
                        Height="32"
                        Click="CancelButton_Click"/>

                <Button x:Name="SaveButton"
                        Content="保存"
                        Width="80"
                        Height="32"
                        Margin="10,0,0,0"
                        Background="#4CAF50"
                        Foreground="White"
                        Click="SaveButton_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>